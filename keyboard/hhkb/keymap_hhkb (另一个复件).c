/*
 * Keymap for hhkb
 *   generated by tmk keymap editor
 */
#include <stdint.h>
#include <stdbool.h>
#include <avr/pgmspace.h>
#include "keycode.h"
#include "action.h"
#include "action_macro.h"
#include "keymap.h"

#ifdef KEYMAP_SECTION
const uint16_t fn_actions[] __attribute__ ((section (".keymap.fn_actions"))) = {
#else
static const uint16_t fn_actions[] PROGMEM = {
#endif
    [0]  = ACTION_LAYER_MOMENTARY(1),
    [1]  = ACTION_LAYER_MOMENTARY(2),
    [2]  = ACTION_LAYER_MOMENTARY(3),
    [3]  = ACTION_LAYER_MOMENTARY(4),
    [4]  = ACTION_LAYER_MOMENTARY(5),
    [5]  = ACTION_LAYER_MOMENTARY(6),
    [6]  = ACTION_LAYER_MOMENTARY(7),
    [7]  = ACTION_LAYER_TOGGLE(1),
    [8]  = ACTION_LAYER_TOGGLE(2),
    [9]  = ACTION_LAYER_TOGGLE(3),
    [10] = ACTION_LAYER_TAP_TOGGLE(1),
    [11] = ACTION_LAYER_TAP_TOGGLE(2),
    [12] = ACTION_LAYER_TAP_TOGGLE(3),
    [13] = ACTION_LAYER_TAP_KEY(1, KC_A),
    [14] = ACTION_LAYER_TAP_KEY(2, KC_F),
    [15] = ACTION_LAYER_TAP_KEY(3, KC_J),
    [16] = ACTION_LAYER_TAP_KEY(4, KC_SPACE),
    [17] = ACTION_LAYER_TAP_KEY(5, KC_SCOLON),
    [18] = ACTION_LAYER_TAP_KEY(6, KC_QUOTE),
    [19] = ACTION_LAYER_TAP_KEY(7, KC_SLASH),
    [20] = ACTION_MODS_TAP_KEY(MOD_LSFT, KC_SPACE),
    [21] = ACTION_MODS_TAP_KEY(MOD_LCTL, KC_SPACE),
    [22] = ACTION_MODS_TAP_KEY(MOD_RCTL, KC_QUOTE),
    [23] = ACTION_MODS_TAP_KEY(MOD_RCTL, KC_ENTER),
    [24] = ACTION_MODS_TAP_KEY(MOD_LCTL, KC_ESC),
    [25] = ACTION_MODS_TAP_KEY(MOD_LCTL, KC_BSPACE),
    [26] = ACTION_MODS_ONESHOT(MOD_LCTL),
    [27] = ACTION_MODS_TAP_KEY(MOD_LSFT, KC_ESC),
    [28] = ACTION_MODS_TAP_KEY(MOD_LSFT, KC_BSPACE),
    [29] = ACTION_MODS_ONESHOT(MOD_LSFT),
    [30] = ACTION_MODS_TAP_KEY(MOD_RSFT, KC_GRAVE),
    [31] = ACTION_MODS_TAP_KEY(MOD_RSFT, KC_BSLASH),
};

#ifdef KEYMAP_SECTION
const uint8_t keymaps[][8][8] __attribute__ ((section (".keymap.keymaps"))) = {
#else
static const uint8_t keymaps[][8][8] PROGMEM = {
#endif
    {
        { 0x1f,0x14,0x1a,0x16,0x04,0x1d,0x1b,0x06, },
        { 0x20,0x21,0x15,0x08,0x07,0x09,0x19,0x05, },
        { 0x22,0x23,0x1c,0x17,0x0a,0x0b,0x11,0x00, },
        { 0x1e,0x29,0x2b,0xd8,0xe1,0xe2,0xe3,0x2c, },
        { 0x24,0x25,0x18,0x0c,0x0e,0x0d,0x10,0x00, },
        { 0x31,0x35,0x2a,0x28,0xc0,0xe5,0xe6,0xe7, },
        { 0x26,0x27,0x12,0x13,0xd1,0x0f,0x36,0x00, },
        { 0x2d,0x2e,0x30,0x2f,0x34,0x38,0x37,0x00, },
    },
    {
        { 0x3b,0x01,0x01,0xa9,0xaa,0x01,0x01,0x01, },
        { 0x3c,0x3d,0x01,0x01,0xa8,0x01,0x01,0x01, },
        { 0x3e,0x3f,0x01,0x01,0x01,0x55,0x57,0x00, },
        { 0x3a,0xa5,0x39,0x01,0x01,0x01,0x01,0x01, },
        { 0x40,0x41,0x01,0x46,0x4a,0x54,0x56,0x00, },
        { 0x49,0x4c,0x2a,0x58,0x01,0x01,0x01,0x01, },
        { 0x42,0x43,0x47,0x48,0x50,0x4b,0x4d,0x00, },
        { 0x44,0x45,0x01,0x52,0x4f,0x51,0x4e,0x00, },
    },
    {
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
    },
    {
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
    },
    {
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
    },
    {
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x50,0x01,0x01, },
        { 0x01,0x01,0x47,0x01,0x01,0x01,0x01,0x4c, },
        { 0x01,0x01,0x01,0x01,0x52,0x51,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x4f,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
    },
    {
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
    },
    {
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
        { 0x01,0x01,0x01,0x01,0x01,0x01,0x01,0x01, },
    },
};

/* translates key to keycode */
uint8_t keymap_key_to_keycode(uint8_t layer, key_t key)
{
    return pgm_read_byte(&keymaps[(layer)][(key.row)][(key.col)]);
}

/* translates Fn index to action */
action_t keymap_fn_to_action(uint8_t keycode)
{
    action_t action;
    if (FN_INDEX(keycode) < sizeof(fn_actions) / sizeof(fn_actions[0])) {
        action.code = pgm_read_word(&fn_actions[FN_INDEX(keycode)]);
    } else {
        action.code = ACTION_NO;
    }
    return action;
}

